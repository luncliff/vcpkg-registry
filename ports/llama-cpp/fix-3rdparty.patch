diff --git a/CMakeLists.txt b/CMakeLists.txt
index c231ec0..fa33fa2 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -217,7 +217,8 @@ endif()
 if (LLAMA_BUILD_COMMON)
     add_subdirectory(common)
     if (LLAMA_HTTPLIB)
-        add_subdirectory(vendor/cpp-httplib)
+        # vendor-managed httplib is optional; prefer system package when available
+        find_package(httplib CONFIG REQUIRED GLOBAL)
     endif()
 endif()
 
diff --git a/common/CMakeLists.txt b/common/CMakeLists.txt
index f7b9915..2044299 100644
--- a/common/CMakeLists.txt
+++ b/common/CMakeLists.txt
@@ -85,7 +85,9 @@ add_library(${TARGET} STATIC
     unicode.h
     )
 
-target_include_directories(${TARGET} PUBLIC . ../vendor)
+target_include_directories(${TARGET} PUBLIC "${PROJECT_SOURCE_DIR}/vendor")
+find_path(MINJA_INCLUDE_DIRS "minja/chat-template.hpp" REQUIRED)
+target_include_directories(${TARGET} PUBLIC ${CMAKE_CURRENT_SOURCE_DIR} ${MINJA_INCLUDE_DIRS})
 target_compile_features   (${TARGET} PUBLIC cxx_std_17)
 
 if (BUILD_SHARED_LIBS)
@@ -105,9 +107,10 @@ if (LLAMA_CURL)
     include_directories(${CURL_INCLUDE_DIRS})
     set(LLAMA_COMMON_EXTRA_LIBS ${LLAMA_COMMON_EXTRA_LIBS} ${CURL_LIBRARIES})
 elseif (LLAMA_HTTPLIB)
-    # otherwise, use cpp-httplib
+    # otherwise, use system-provided httplib (preferred)
     target_compile_definitions(${TARGET} PUBLIC LLAMA_USE_HTTPLIB)
-    set(LLAMA_COMMON_EXTRA_LIBS ${LLAMA_COMMON_EXTRA_LIBS} cpp-httplib)
+    find_package(httplib CONFIG REQUIRED GLOBAL)
+    set(LLAMA_COMMON_EXTRA_LIBS ${LLAMA_COMMON_EXTRA_LIBS} httplib::httplib)
 endif()
 
 if (LLAMA_LLGUIDANCE)
diff --git a/common/chat.cpp b/common/chat.cpp
index 7e94069..2fe6bf4 100644
--- a/common/chat.cpp
+++ b/common/chat.cpp
@@ -1697,7 +1697,7 @@ static common_chat_params common_chat_params_init_deepseek_v3_1(const common_cha
     };
 
     auto prompt = apply(tmpl, inputs,
-                       /* messages_override= */ inputs.messages,
+                       /* messages_override= */ std::optional<json>(inputs.messages),
                        /* tools_override= */ std::nullopt,
                        additional_context);
     data.prompt = prompt;
diff --git a/tools/CMakeLists.txt b/tools/CMakeLists.txt
index 8df3f41..53df766 100644
--- a/tools/CMakeLists.txt
+++ b/tools/CMakeLists.txt
@@ -3,6 +3,14 @@
 find_package(Threads REQUIRED)
 
 # third-party
+if(LLAMA_SERVER_SSL)
+    find_package(ZLIB REQUIRED GLOBAL)
+    find_package(OpenSSL REQUIRED GLOBAL)
+    link_libraries(ZLIB::ZLIB OpenSSL::SSL OpenSSL::Crypto)
+    if(APPLE)
+        link_libraries("-framework Security" "-framework SystemConfiguration")
+    endif()
+endif()
 
 # ...
 
@@ -39,3 +47,4 @@ else()
     endif()
     add_subdirectory(fit-params)
 endif()
+    include_directories("${PROJECT_SOURCE_DIR}/vendor")
diff --git a/tools/mtmd/CMakeLists.txt b/tools/mtmd/CMakeLists.txt
index 317d5f1..4178292 100644
--- a/tools/mtmd/CMakeLists.txt
+++ b/tools/mtmd/CMakeLists.txt
@@ -39,7 +39,10 @@ target_link_libraries     (mtmd PUBLIC ggml llama)
 target_link_libraries     (mtmd PRIVATE Threads::Threads)
 target_include_directories(mtmd PUBLIC  .)
 target_include_directories(mtmd PRIVATE ../..)
-target_include_directories(mtmd PRIVATE ../../vendor)
+target_include_directories(mtmd PRIVATE "${PROJECT_SOURCE_DIR}/vendor")
+find_path(STB_INCLUDE_DIR stb_image.h REQUIRED)
+find_path(MINIAUDIO_INCLUDE_DIR miniaudio.h REQUIRED)
+target_include_directories(mtmd PUBLIC ${STB_INCLUDE_DIR} ${MINIAUDIO_INCLUDE_DIR})
 target_compile_features   (mtmd PRIVATE cxx_std_17)
 
 if (BUILD_SHARED_LIBS)
diff --git a/tools/mtmd/mtmd-helper.cpp b/tools/mtmd/mtmd-helper.cpp
index 902a4b4..a2cf27c 100644
--- a/tools/mtmd/mtmd-helper.cpp
+++ b/tools/mtmd/mtmd-helper.cpp
@@ -27,10 +27,10 @@
 #define MA_NO_ENGINE
 #define MA_NO_GENERATION
 #define MA_API static
-#include "miniaudio/miniaudio.h"
+#include <miniaudio.h>
 
 #define STB_IMAGE_IMPLEMENTATION
-#include "stb/stb_image.h"
+#include <stb_image.h>
 
 #ifdef MTMD_INTERNAL_HEADER
 #error "mtmd-helper is a public library outside of mtmd. it must not include internal headers"
diff --git a/tools/server/CMakeLists.txt b/tools/server/CMakeLists.txt
index a39b4c5..b343597 100644
--- a/tools/server/CMakeLists.txt
+++ b/tools/server/CMakeLists.txt
@@ -61,7 +61,9 @@ install(TARGETS ${TARGET} RUNTIME)
 
 target_include_directories(${TARGET} PRIVATE ../mtmd)
 target_include_directories(${TARGET} PRIVATE ${CMAKE_SOURCE_DIR})
-target_link_libraries(${TARGET} PRIVATE server-context PUBLIC common cpp-httplib ${CMAKE_THREAD_LIBS_INIT})
+target_link_libraries(${TARGET} PRIVATE server-context PUBLIC common ${CMAKE_THREAD_LIBS_INIT})
+find_package(httplib CONFIG REQUIRED GLOBAL)
+target_link_libraries(${TARGET} PRIVATE httplib::httplib)
 
 if (WIN32)
     TARGET_LINK_LIBRARIES(${TARGET} PRIVATE ws2_32)
diff --git a/tools/server/server-http.cpp b/tools/server/server-http.cpp
index 5d67e57..c0f959e 100644
--- a/tools/server/server-http.cpp
+++ b/tools/server/server-http.cpp
@@ -2,7 +2,7 @@
 #include "server-http.h"
 #include "server-common.h"
 
-#include <cpp-httplib/httplib.h>
+#include <httplib.h>
 
 #include <functional>
 #include <string>
diff --git a/tools/server/server-models.cpp b/tools/server/server-models.cpp
index 56e1dc4..e1580b8 100644
--- a/tools/server/server-models.cpp
+++ b/tools/server/server-models.cpp
@@ -4,7 +4,7 @@
 #include "preset.h"
 #include "download.h"
 
-#include <cpp-httplib/httplib.h> // TODO: remove this once we use HTTP client from download.h
+#include <httplib.h> // TODO: remove this once we use HTTP client from download.h
 #include <sheredom/subprocess.h>
 
 #include <functional>
diff --git a/tools/tts/CMakeLists.txt b/tools/tts/CMakeLists.txt
index 76320d4..3b65445 100644
--- a/tools/tts/CMakeLists.txt
+++ b/tools/tts/CMakeLists.txt
@@ -6,3 +6,6 @@ target_compile_features(${TARGET} PRIVATE cxx_std_17)
 if(LLAMA_TOOLS_INSTALL)
     install(TARGETS ${TARGET} RUNTIME)
 endif()
+
+find_package(nlohmann_json CONFIG REQUIRED GLOBAL)
+target_link_libraries(${TARGET} PRIVATE nlohmann_json::nlohmann_json)
